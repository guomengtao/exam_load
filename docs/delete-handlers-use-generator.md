# æ–¹æ¡ˆï¼šdelete-handlers-use-generator

## ğŸ¯ æœ€ç»ˆç›®æ ‡

å½»åº•åˆ é™¤ `handlers` æ–‡ä»¶å¤¹ï¼Œå°†å…¶ä¸­çš„æ¥å£ç»Ÿä¸€å‡çº§ä¸ºç”±ç”Ÿæˆå™¨è‡ªåŠ¨ç”Ÿæˆçš„æ¥å£é€»è¾‘ï¼Œä¿æŒæ¶æ„ä¸€è‡´æ€§ï¼Œæé«˜å¯ç»´æŠ¤æ€§ã€‚

### ğŸ“ åˆ†å±‚æ‹†åˆ†åŸåˆ™ä¸çº¦æŸ

ä¸ºäº†ç¡®ä¿æ¥å£è¿ç§»åçš„ä»£ç æ¶æ„åˆç†ã€èŒè´£æ¸…æ™°ï¼Œæ‰€æœ‰æ¥å£éœ€éµå¾ªä»¥ä¸‹åˆ†å±‚è§„èŒƒï¼š

#### controller å±‚ï¼ˆæ§åˆ¶å™¨ï¼‰

- ä»…è´Ÿè´£è¯·æ±‚æ¥æ”¶ã€å‚æ•°ç»‘å®šä¸å“åº”è¾“å‡ºã€‚
- ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘æˆ–æ•°æ®åº“æ“ä½œã€‚
- å¯ä»¥è¿›è¡Œè¯·æ±‚æ—¥å¿—æ‰“å°ã€ç®€å•æƒé™åˆ¤æ–­ï¼Œä½†ä¸å¾—åŒ…å«ä¸šåŠ¡ `if` æ¡ä»¶åˆ†æ”¯ã€‚

#### biz å±‚ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰

- æ‰¿æ‹…æ ¸å¿ƒé€»è¾‘åˆ¤æ–­ä¸æ¡ä»¶å¤„ç†ï¼ˆå¦‚å‚æ•°æ ¡éªŒã€æ•°æ®å¯¹æ¯”ã€ä¸šåŠ¡çŠ¶æ€æœºç­‰ï¼‰ã€‚
- å¦‚æœæ¥å£ä¸­å­˜åœ¨å¤šå±‚ `if` æˆ–çŠ¶æ€åˆ¤æ–­ï¼Œ**å¿…é¡»**è¿ç§»è‡³ biz å±‚å¤„ç†ã€‚
- ä¸è´Ÿè´£æ•°æ®åº“æˆ–ç¼“å­˜è®¿é—®ï¼Œä»…è°ƒç”¨ service æä¾›çš„èƒ½åŠ›ã€‚

#### service å±‚ï¼ˆæœåŠ¡å±‚ï¼‰

- è´Ÿè´£æ•°æ®åº“ï¼ˆGORMï¼‰å’Œç¼“å­˜ï¼ˆRedisï¼‰çš„å…·ä½“è¯»å†™ã€‚
- **ä¸å…è®¸å‡ºç°å¤æ‚ `if` åˆ¤æ–­æˆ–ä¸šåŠ¡çŠ¶æ€é€»è¾‘**ï¼Œæ‰€æœ‰åˆ¤æ–­åº”æå‰ç”± biz å±‚å®Œæˆã€‚
- å°è£…å¸¸è§æ•°æ®åº“ä¸ Redis æ“ä½œï¼Œæä¾›é€šç”¨æ–¹æ³•ã€‚

#### Redis æ“ä½œè§„èŒƒ

- æ‰€æœ‰ Redis è°ƒç”¨å¿…é¡»é€šè¿‡ç»Ÿä¸€å·¥å…·åŒ…å°è£…ï¼Œä½äº `utils/redis.go`ã€‚
- ä¸å…è®¸åœ¨ controller æˆ– biz ä¸­ç›´æ¥è°ƒç”¨ Redisã€‚
- Redis key å‘½ååº”è§„èŒƒï¼ˆå¦‚ `prefix:module:id`ï¼‰ï¼Œå¹¶é…ç½®è¶…æ—¶æ—¶é—´ã€‚
- å°½é‡é‡‡ç”¨ç»“æ„åŒ–æ•°æ®ï¼ˆå¦‚ JSON ç¼–ç å­˜å‚¨ï¼‰ä»¥ä¾¿è°ƒè¯•ã€‚

#### æ¥å£è¿ç§»æ‹†åˆ†è¦ç´ ç¤ºä¾‹

- âŒ é”™è¯¯ï¼šcontroller ä¸­åŒ…å« `if å‚æ•° == xxx` åˆ¤æ–­ã€‚
- âœ… æ­£ç¡®ï¼šcontroller è°ƒç”¨ `biz.HandleXxx(params)`ï¼Œæ‰€æœ‰åˆ¤æ–­åœ¨ biz ä¸­å®Œæˆã€‚
- âŒ é”™è¯¯ï¼šservice ä¸­å¯¹ä¸åŒè¯·æ±‚å‚æ•°æ‰§è¡Œé€»è¾‘åˆ†æ”¯ã€‚
- âœ… æ­£ç¡®ï¼šservice ä»…æš´éœ² `FindXxx`, `UpdateXxx`ï¼Œä¸å…³å¿ƒè¯·æ±‚åœºæ™¯ã€‚

- âœ… åˆ é™¤ `/handlers/*.go`
- ğŸ”„ éƒ¨åˆ†é€šç”¨å·¥å…·å‡½æ•°æˆ–ä¸Šä¼ æ¥å£å¯è¿ç§»åˆ° `/controllers` æˆ– `/utils`
- ğŸ“¦ æ¥å£è¿ç§»åç»Ÿä¸€ç”± `RegisterGeneratedRoutes(router)` è‡ªåŠ¨æ³¨å†Œ

---

## ğŸ§­ é¡¹ç›®è¯„ä¼°

### âœ… é€‚åˆç”¨ç”Ÿæˆå™¨å‡çº§çš„æ¨¡å—ï¼ˆå·²å…·å¤‡æ¨¡å‹ã€å­—æ®µé…ç½®ï¼‰

- exam_template
- exam_paper
- answer
- admin
- role
- user
- file_info
- teacher
- badminton_game

è¿™äº›æ¨¡å‹å…·å¤‡æ ‡å‡†çš„ CURD æ“ä½œå’Œç»“æ„ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œï¼š

```bash
go run utils/gen/gen.go -table=è¡¨å -cmd=a
```

---

## âš ï¸ é£é™©ä¸æ³¨æ„äº‹é¡¹

1. **æ¥å£è·¯å¾„å˜åŒ–**ï¼š
   - å¦‚æœå‰ç«¯ä½¿ç”¨çš„æ˜¯è€çš„ handlers ä¸­å®šä¹‰çš„è·¯å¾„ï¼Œæ›¿æ¢ä¸ºç”Ÿæˆå™¨é€»è¾‘å¯èƒ½ä¼šå¯¼è‡´è·¯å¾„æˆ–å­—æ®µåä¸å…¼å®¹ã€‚
   - è§£å†³æ–¹æ¡ˆï¼š
     - ä¿æŒæ—§è·¯ç”±å…¼å®¹æ€§ï¼ˆæ‰‹åŠ¨æ˜ å°„ï¼‰
     - æˆ–è¦æ±‚å‰ç«¯é‡æ–°å¯¹æ¥ï¼ˆæ¨èé•¿è¿œæ–¹æ¡ˆï¼‰

2. **æ¥å£é€»è¾‘å·®å¼‚**ï¼š
   - åŸ handlers ä¸­æ¥å£å¯èƒ½å­˜åœ¨ç‰¹æ®Šé€»è¾‘ï¼ˆå¦‚åˆ†é¡µã€Redis ç¼“å­˜ã€è¿‡æ»¤å­—æ®µï¼‰ã€‚
   - ç”Ÿæˆå™¨ä»…æä¾›é€šç”¨é€»è¾‘ï¼Œéƒ¨åˆ†åŠŸèƒ½éœ€æ‰‹åŠ¨æ‰©å±• `Skeleton` å±‚ã€‚

3. **æ‰¹é‡æ¥å£ä¸ºä¸»**ï¼š
   - å½“å‰ç³»ç»Ÿæ¥å£å¤§å¤šä¸ºæ‰¹é‡æ¥å£ï¼Œå¦‚ `BatchCreate`, `BatchUpdate`, `BatchDelete`ã€‚
   - ç”Ÿæˆå™¨æ”¯æŒè¿™äº›æ“ä½œï¼Œä½†å‰ç«¯å¦‚ä¼ å‚æ ¼å¼å˜åŒ–ï¼Œéœ€åŒæ­¥æ›´æ–°è°ƒç”¨æ–¹å¼ã€‚

---

## âœ… å»ºè®®è½åœ°è·¯å¾„

1. ç”¨ç”Ÿæˆå™¨é‡å»ºæ‰€éœ€æ¨¡å—çš„ CURD æ¥å£
2. ç”¨æµ‹è¯•è„šæœ¬ç¡®ä¿ç”Ÿæˆæ¥å£åŠŸèƒ½å®Œæ•´
3. åˆ é™¤ handlers ä¸­çš„å†—ä½™è€æ¥å£æ–‡ä»¶
4. routes ä¸­å…¨é¢åˆ‡æ¢ä¸º `RegisterGeneratedRoutes`
5. å‰ç«¯é€æ­¥é€‚é…æ–°æ¥å£ï¼ˆæ¨èå°†å­—æ®µç»“æ„å¯¹æ¯”å†™å…¥æ–‡æ¡£ï¼‰

---

## ğŸ“Œ æ€»ç»“

åˆ é™¤ `handlers` æ˜¯æœ¬é¡¹ç›®æ¶æ„å‡çº§çš„æ ¸å¿ƒæ­¥éª¤ï¼Œé¢„è®¡ä¸­ä½é£é™©ï¼ŒæŠ•å…¥äº§å‡ºæ¯”é«˜ã€‚é…åˆç”Ÿæˆå™¨ä½¿ç”¨å¯å®ç°æ¥å£ç»Ÿä¸€ã€é€»è¾‘å¤ç”¨ã€ç»´æŠ¤ç®€å•ã€‚å‰ç«¯å¦‚èƒ½é…åˆæ›´æ–°æ¥å£è°ƒç”¨æ–¹å¼ï¼Œå°†è¿›ä¸€æ­¥é™ä½æŠ€æœ¯å€ºã€‚

---

## ğŸš« ä¸éœ€è¦ç”Ÿæˆå™¨çš„æ¥å£è¿ç§»åå•

ä»¥ä¸‹æ¥å£åŠŸèƒ½ç®€å•ã€ä¸ä¸šåŠ¡æ¨¡å‹è§£è€¦ï¼Œé€‚åˆ**æ‰‹åŠ¨è¿ç§»**æˆ–**ä¿ç•™è‡³ `/controllers` ç›®å½•**ï¼Œæ— éœ€ç”Ÿæˆå™¨å‚ä¸ï¼š

| æ–‡ä»¶å | æ¨èè¿ç§»ä½ç½® | ç†ç”± | è¿ç§»éš¾åº¦ |
|--------|----------------|------|-----------|
| `dbinfo.go` | `/controllers/dbinfo_controller.go` | æŸ¥è¯¢æ•°æ®åº“ç»“æ„ä¿¡æ¯ï¼Œéæ¨¡å‹æ“ä½œ | ğŸŸ¢ ä½ |
| `status.go` | `/controllers/status_controller.go` | ç³»ç»ŸçŠ¶æ€æ¥å£ï¼Œé€šå¸¸ä»…è¿”å› JSON | ğŸŸ¢ ä½ |
| `version.go` | `/controllers/version_controller.go` | è¿”å›ç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯ï¼Œé€»è¾‘æç®€ | ğŸŸ¢ ä½ |
| `upload.go` | `/controllers/upload_controller.go` | åŒ…å«æ–‡ä»¶ä¸Šä¼ é€»è¾‘ï¼Œéœ€è¿ç§»è‡³ç»Ÿä¸€ä¸Šä¼ å…¥å£ | ğŸŸ¡ ä¸­ï¼ˆæ¶‰åŠ multipart/form-dataï¼‰ |
| `source_check.go` | `/controllers/source_controller.go` | æ•°æ®æºæ ¡éªŒå·¥å…·ç±»æ¥å£ | ğŸŸ¡ ä¸­ |
| `hello.go` | ï¼ˆå¯åˆ é™¤æˆ–åˆå¹¶è‡³ç¤ºä¾‹æ§åˆ¶å™¨ï¼‰ | æ¼”ç¤ºç”¨é€”ï¼Œæ— å®é™…ä¾èµ– | ğŸŸ¢ ä½ |

> ğŸ’¡ æç¤ºï¼šè¿™äº›æ¥å£å¯ä»¥ç›´æ¥é‡å‘½å/ç§»åŠ¨è‡³ `controllers/`ï¼Œå¹¶æ³¨å†Œè¿› `routes.go` ä¸­ï¼Œä¸ä¼šå½±å“ä¸šåŠ¡é€»è¾‘æˆ–æ•°æ®åº“ç»“æ„ã€‚

---

## ğŸ¯ è¿ç§»ç›®æ ‡å®šä½ä¸æ‰§è¡Œç»†èŠ‚æ›´æ–°

æœ¬æ¬¡è¿ç§»å°†éµå¾ªä»¥ä¸‹å‡ ç‚¹åŸåˆ™å’Œç­–ç•¥ï¼Œé‡ç‚¹æ˜ç¡®æ¥å£ç»“æ„è°ƒæ•´ä¸èŒè´£åˆ’åˆ†ï¼š

### ğŸ§­ è¿ç§»æ ¸å¿ƒåŸåˆ™

1. **ç”Ÿæˆå™¨ä½œä¸ºè¾…åŠ©å·¥å…·**ï¼šç”Ÿæˆå™¨æ˜¯æå‡æ•ˆç‡çš„è¾…åŠ©å·¥å…·ï¼Œ**ä¸æ˜¯å¼ºåˆ¶**ã€‚é€‚åˆç»“æ„æ ‡å‡†ã€å­—æ®µå·²å»ºæ¨¡çš„æ¥å£ï¼›å¯¹å¤æ‚é€»è¾‘æ¥å£ï¼ˆå¦‚ç­”é¢˜ç›¸å…³ï¼‰ä¸å»ºè®®ä½¿ç”¨ç”Ÿæˆå™¨ã€‚
2. **ä¿è¯åŠŸèƒ½å¹³ç§»ä¼˜å…ˆ**ï¼šæ¥å£è¿ç§»çš„é¦–è¦ç›®æ ‡æ˜¯åŠŸèƒ½ç­‰æ•ˆï¼Œä¸æ·»åŠ æ— å…³ä¼˜åŒ–é€»è¾‘ï¼Œç¡®ä¿ä¸šåŠ¡å¹³ç¨³è¿‡æ¸¡ã€‚
3. **é¼“åŠ±åˆ†å±‚é‡æ„**ï¼šå³ä½¿ä¸ä½¿ç”¨ç”Ÿæˆå™¨ï¼Œæ‰€æœ‰è¿ç§»æ¥å£ä¹Ÿå»ºè®®æŒ‰ `controller â†’ biz â†’ service` æ‹†åˆ†ï¼Œæå‡å¯æµ‹è¯•æ€§ä¸é€»è¾‘æ¸…æ™°åº¦ã€‚

### ğŸ“¦ åˆ†å±‚æ‹†åˆ†ç»†åˆ™ï¼ˆè¡¥å……ï¼‰

| é€»è¾‘ | å»ºè®®æ‰€åœ¨å±‚ | è¯´æ˜ |
|------|-------------|------|
| è¯·æ±‚æ¥æ”¶ã€å‚æ•°ç»‘å®šã€å“åº”æ ¼å¼ | controller | ä¸åŒ…å« if/ä¸šåŠ¡åˆ¤æ–­ |
| å‚æ•°åˆæ³•æ€§åˆ¤æ–­ã€çŠ¶æ€æµè½¬ã€æ ¸å¿ƒ if/else ç»“æ„ | biz | æ§åˆ¶é€»è¾‘å¿…é¡»æ¬åˆ°è¿™é‡Œ |
| GORM æ“ä½œã€Redis æ“ä½œï¼ˆé€šè¿‡å·¥å…·åŒ…ï¼‰ | service | ç¦æ­¢å‡ºç°ä¸šåŠ¡åˆ†æ”¯ |
| Redis get/set/del å°è£… | utils/redis.go | æ‰€æœ‰ç¼“å­˜æ“ä½œç»Ÿä¸€èµ°å·¥å…·åŒ… |

### ğŸ§± ç¤ºä¾‹å¯¹ç…§

- âŒ é”™è¯¯åšæ³•ï¼šcontroller é‡Œå­˜åœ¨ `if req.Type == "xxx"` åˆ†æ”¯
- âœ… æ­£ç¡®åšæ³•ï¼šcontroller è°ƒç”¨ `biz.HandleXXX(req)`ï¼Œåˆ¤æ–­é€»è¾‘åœ¨ biz å†…å¤„ç†
- âŒ é”™è¯¯åšæ³•ï¼šservice é‡ŒåŒºåˆ†å¤šä¸ªå‚æ•°é€»è¾‘
- âœ… æ­£ç¡®åšæ³•ï¼šservice æä¾›å•ä¸€åŠŸèƒ½ç‚¹æ–¹æ³•ï¼Œå¦‚ `SaveAnswer(redisKey, value)`ï¼Œç”± biz æ§åˆ¶è°ƒç”¨æµç¨‹

### ğŸ” ä¸ç”¨ç”Ÿæˆå™¨ä½†ä»å»ºè®®åˆ†å±‚çš„æ¥å£ï¼ˆå¯ç‹¬ç«‹è¿ç§»ï¼‰

é’ˆå¯¹ `handlers/exam_answer.go` ç­‰æ ¸å¿ƒæ¥å£ï¼Œ**ä¸ä½¿ç”¨ç”Ÿæˆå™¨ç”Ÿæˆ Skeleton**ï¼Œè€Œæ˜¯ç‹¬ç«‹è¿ç§»ä¸ºï¼š

```
controllers/exam_answer_controller.go
biz/exam_answer_biz.go
services/exam_answer_service.go
```

æ­¤ç±»æ¥å£ä¸ºé¡¹ç›®æ ¸å¿ƒï¼Œé€»è¾‘å¤æ‚ã€å½±å“èŒƒå›´å¤§ï¼Œé‡‡ç”¨æ‰‹åŠ¨è¿ç§»æ˜¯æ›´å®‰å…¨å’Œçµæ´»çš„æ–¹å¼ã€‚

> ğŸš¨ æ³¨ï¼šç­”é¢˜æµç¨‹æ¥å£æ¶‰åŠ Redisã€ç­”é¢˜æäº¤ã€è¯„åˆ†ã€è®°å½•ï¼Œç¦æ­¢å¼•å…¥ç”Ÿæˆå™¨ï¼Œé¿å…åŠŸèƒ½æŸåã€‚

---

## ğŸš€ ç”Ÿæˆå™¨å‡çº§ä¸è¿ç§»æ­¥éª¤

### 1. ç”Ÿæˆå™¨å‡çº§

- **è¯¦æƒ…æ¥å£**ï¼šç”Ÿæˆå™¨æ¨¡æ¿ï¼ˆcontrollerã€bizã€serviceï¼‰ç»Ÿä¸€å¢åŠ  `GetDetail` è¯¦æƒ…æ¥å£ï¼Œè·¯ç”±æ³¨å†Œä¸º `group.GET("/:id", s.GetDetail)`ã€‚
- **bitmask å¤„ç†**ï¼šç”Ÿæˆå™¨ç”Ÿæˆçš„ä»£ç ä¸å« bitmask å¤„ç†ï¼Œéœ€åœ¨ controller/biz/service å±‚è¡¥å…… bitmask ç›¸å…³é€»è¾‘ã€‚
- **Redis æ“ä½œè§„èŒƒ**ï¼šæ‰€æœ‰ Redis ç›¸å…³æ“ä½œå¿…é¡»è¿ç§»åˆ° `utils/redis.go`ï¼Œcontroller/biz/service åªè°ƒç”¨å·¥å…·æ–¹æ³•ã€‚

### 2. æ‰¹é‡ç”Ÿæˆç›®æ ‡æ¨¡å—ä»£ç 

- è¿è¡Œå¦‚ `go run utils/gen/gen.go -table=exam_template -cmd=a`ï¼Œæ‰€æœ‰æ¥å£è‡ªåŠ¨å¸¦æœ‰è¯¦æƒ…æ¥å£ã€‚

### 3. è‡ªåŠ¨æ£€æµ‹

- ç”¨ `grep` æˆ–è„šæœ¬æ‰¹é‡æ£€æŸ¥æ‰€æœ‰ controller æ˜¯å¦æœ‰ `GetDetail`ï¼Œç¡®ä¿æ— é—æ¼ã€‚

### 4. bitmask ä¸šåŠ¡è¡¥å……

- ç”Ÿæˆå™¨ç”Ÿæˆçš„ä»£ç ä¸å« bitmask å¤„ç†ï¼Œéœ€åœ¨ controller/biz/service å±‚è¡¥å…… bitmask ç›¸å…³é€»è¾‘ã€‚

### 5. Redis æ“ä½œè§„èŒƒ

- æ‰€æœ‰ Redis ç›¸å…³æ“ä½œå¿…é¡»è¿ç§»åˆ° `utils/redis.go`ï¼Œcontroller/biz/service åªè°ƒç”¨å·¥å…·æ–¹æ³•ã€‚

### 6. è¿ç§»/åˆ é™¤ handlers

- å·²ç”Ÿæˆå™¨è¦†ç›–çš„ handlers å¯ç›´æ¥åˆ é™¤ã€‚
- å¤æ‚ä¸šåŠ¡ï¼ˆå¦‚ exam_answerã€exam_paper_redisï¼‰éœ€æ‰‹åŠ¨è¿ç§»åˆ†å±‚åå†åˆ ã€‚

---

## ğŸ“Œ è¿ç§»/åˆ é™¤æ¸…å•ï¼ˆä¸¾ä¾‹ï¼‰

| handlers æ–‡ä»¶         | è¿ç§»æ–¹å¼         | è¿ç§»åä½ç½®/è¯´æ˜                        |
|----------------------|------------------|----------------------------------------|
| exam_template.go     | å·²ç”Ÿæˆå™¨è¦†ç›–     | å¯ç›´æ¥åˆ é™¤                             |
| exam.go              | å·²ç”Ÿæˆå™¨è¦†ç›–     | å¯ç›´æ¥åˆ é™¤                             |
| exam_paper.go        | å·²ç”Ÿæˆå™¨è¦†ç›–     | å¯ç›´æ¥åˆ é™¤                             |
| exam_answer.go       | æ‰‹åŠ¨åˆ†å±‚è¿ç§»     | controllers/biz/services/redis_helper  |
| exam_paper_redis.go  | æ‰‹åŠ¨åˆ†å±‚è¿ç§»     | services/redis_helper                  |

---

## ğŸ“Œ è¿ç§»æ³¨æ„äº‹é¡¹

- è¿ç§»æ—¶ä¸¥æ ¼éµå¾ª controller â†’ biz â†’ service â†’ utils åˆ†å±‚
- redis æ“ä½œå…¨éƒ¨ç”¨ utils/redis.go å°è£…
- controller ä¸åšä¸šåŠ¡åˆ¤æ–­ï¼Œbiz è´Ÿè´£æ‰€æœ‰ if/else ä¸šåŠ¡æµè½¬
- service åªåšæ•°æ®å­˜å–ï¼Œä¸åšä¸šåŠ¡åˆ¤æ–­

---

## ğŸ“Œ ç»“è®º

- **handlers ç›®å½•ä¸‹ exam_template.goã€exam.goã€exam_paper.go å¯ç›´æ¥åˆ é™¤**
- **exam_answer.goã€exam_paper_redis.go éœ€æ‰‹åŠ¨è¿ç§»åˆ†å±‚åå†åˆ é™¤**
- è¿ç§»åæ‰€æœ‰æ¥å£ç»Ÿä¸€ç”¨ç”Ÿæˆå™¨æ³¨å†Œï¼Œå¤æ‚ä¸šåŠ¡æ¥å£å•ç‹¬æ³¨å†Œ

å¦‚éœ€å…·ä½“è¿ç§»ä»£ç æ ·ä¾‹æˆ–è¿ç§»è„šæœ¬ï¼Œè¯·å‘ŠçŸ¥ï¼